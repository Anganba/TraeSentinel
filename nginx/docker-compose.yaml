services:
  nginx:
    image: nginx:latest
    container_name: nginx-demo-1
    restart: unless-stopped
    networks:
      - frontend

    labels:
      - "traefik.enable=true"

      # ===============================================================
      # üåç HTTP Router (Traefik auto-redirects HTTP ‚Üí HTTPS globally)
      # ===============================================================
      - "traefik.http.routers.nginx.rule=Host(`nginx.${DOMAIN}`)"
      - "traefik.http.routers.nginx.entrypoints=web"

      # ===============================================================
      # üîí HTTPS Secure Router
      # ===============================================================
      - "traefik.http.routers.nginx-secure.rule=Host(`nginx.${DOMAIN}`)"
      - "traefik.http.routers.nginx-secure.entrypoints=websecure"
      - "traefik.http.routers.nginx-secure.tls.certresolver=${PROVIDER}"
      - "traefik.http.routers.nginx-secure.service=nginx-svc"

      # üß© Apply global secure-headers middleware (already defined in Traefik)
      - "traefik.http.routers.nginx-secure.middlewares=secure-headers@docker"

      # ===============================================================
      # ‚öôÔ∏è Service Definition
      # ===============================================================
      - "traefik.http.services.nginx-svc.loadbalancer.server.port=80"

networks:
  frontend:
    external: true
